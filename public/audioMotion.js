/*! For license information please see audioMotion.js.LICENSE.txt */
(()=>{var e,t={6965:(e,t,a)=>{"use strict";var n=a(4015);const o="/music",s="electron"in window,i=s&&/Windows/.test(navigator.userAgent),l=!!window.showDirectoryPicker,r="Click to open a new root folder",c="No music found on server and no browser support for File System API",d=0;let u,f,p,h,m,b,g=[],v=/.*/,y=[],k=!1,w=!1,x=!1;function L(e,t){h.innerHTML="",m.innerHTML="",m.style.backgroundImage="";const a=(e,t)=>{const a=document.createElement("li"),n=e.name||e;a.dataset.type=null!==n.match(/\.(m3u|m3u8)$/)&&"file"==t?"list":t,a.dataset.path=n,a.innerText=n,a.handle=e.handle,m.append(a)},n=e=>m.style.backgroundImage="linear-gradient( #fff9 0%, #fff9 100% )"+(e?`, url('${e}')`:"");if(0==y.length&&(h.innerHTML=c),g.forEach((({dir:e},t)=>{h.innerHTML+=`<li data-depth="${g.length-t-1}">${e}</li> ${i?"\\":"/"==e?"":"/"} `})),y.forEach((e=>{m.innerHTML+=`<li data-type="mount" ${x&&!u?'class="full-panel"':""} data-path="${e}">[ ${e} ]</li>`})),g.length>1&&(m.innerHTML+='<li data-type="dir" data-path="..">[ parent folder ]</li>'),e){const{cover:t,dirs:o,files:s}=e;o&&o.forEach((e=>a(e,"dir"))),s&&s.forEach((e=>a(e,"file"))),t&&t.handle?t.handle.getFile().then((e=>n(URL.createObjectURL(e)))):n(t?C(t):"")}m.scrollTop=t||0}function S(e,t){let a,n,o=e&&"string"!=typeof e?e:null;if(o&&(e=o.name),e)if(".."==e){a=g.pop();const e=g[g.length-1];e&&e.handle&&(o=e.handle)}else g.push({dir:e,scrollTop:m.scrollTop,handle:o});return m.innerHTML="<li>Loading...</li>",n=C(),new Promise((async e=>{const s=n=>{!1!==n&&(k&&!x||(n=P(n)),L(n,t||a&&a.scrollTop),p&&p(g),e(!0)),e(!1)};if(u){o&&(u=o);let e=[];for await(const t of u.entries())e.push(t);s(e)}else fetch(n).then((e=>200==e.status&&(k?e.json():e.text()))).then((e=>s(e))).catch((()=>e(!1)))}))}function E(e){return e.replace(/[#%&]/g,(e=>({"#":"%23","%":"%25","&":"%26"}[e])))}function C(e,t){let a="";return g.forEach((({dir:e})=>{a+=e+("/"==e?"":"/")})),e&&(a+=e),a=E(a),s?(a=a.replace(/\//g,"%2f"),t||(a=(e?"/getFile/":"/getDir/")+a)):b==d&&"/"==a[0]&&(a=a.slice(1)),a}function $(e="li"){let t=[];return m.querySelectorAll(e).forEach((e=>{["file","list"].includes(e.dataset.type)&&t.push({file:C(e.dataset.path),handle:e.handle,type:e.dataset.type})})),t}async function A(e){const t=[...g],a=e.split("/");let n=t[t.length-1].handle;for(;a.length>1;){const e=a.shift();".."==e?(t.pop(),n=t[t.length-1].handle):(n=await n.getDirectoryHandle(e),t.push({handle:n}))}return await n.getFileHandle(a.shift())}function T(e){const t=e.match(/href="[^"]*"[^>]*>[^<]*<\/a>/gi);let a=[];for(const e of t){const t=e.match(/href="([^"]*)"[^>]*>\s*([^<]*)<\/a>/i)[1],n="/"==t.slice(-1),o=t.slice(t.lastIndexOf("/",n?t.length-2:void 0)+1),s=decodeURIComponent(o.slice(0,n?-1:void 0));a.push({url:o,file:s})}return a}function P(e){const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i;let a=[],n=[],o=[];const s=(e,a)=>{const n=new RegExp(`${a}.*${t.source}`,"i");return e.find((e=>(e.name||e).match(n)))};if(x)for(const[s,i]of e)i instanceof FileSystemDirectoryHandle?n.push({name:s,handle:i}):i instanceof FileSystemFileHandle&&(s.match(t)&&o.push({name:s,handle:i}),s.match(v)&&a.push({name:s,handle:i}));else for(const{url:s,file:i}of T(e))"/"==s.slice(-1)?i.match(/(parent directory|\.\.)/i)||n.push(i):(i.match(t)&&o.push(i),i.match(v)&&a.push(i));const i=(e,t)=>{const a="object"==typeof e;return(new Intl.Collator).compare(...a?[e.name,t.name]:[e,t])};return{cover:s(o,"cover")||s(o,"folder")||s(o,"front")||o[0],dirs:n.sort(i),files:a.sort(i)}}async function O(e){if(!e)return!1;const t=[...g],a=e[e.length-1];g=e,a&&a.handle&&(u=a.handle);const n=await S();return n||(g=t),n}var I=a(6015),M=(a(6216),a(7783)),R=a(246),_=a(4596),D=a.n(_);R.Ay.mount(new R.cR);const F="electron"in window,q=F&&/Windows/.test(navigator.userAgent),B="/getFile/",H="/getCover/",N="/savePlist/",j=location.origin+location.pathname,z="24.3.0",U=F?"/getBackground":"backgrounds",W=4,K=2e3,G="0",Y="1",J="2",X="3",V="4",Z="0",Q="1",ee="2",te="0",ae="1",ne="2",oe="3",se="6",ie="7",le="8",re={album:"",artist:"",codec:"",cover:"",duration:"",file:"",quality:"",title:""},ce="dual-combined",de="single",ue="gradient",fe="bar-index",pe="bar-level",he=20,me=["mp3","flac","m4a","aac","ogg","wav"],be=["jpg","jpeg","webp","avif","png","gif","bmp"],ge=["m3u","m3u8"],ve=["mkv","mpg","webm","mp4","avi","mov"],ye="local",ke="bgDir",we="custom-grads",xe="custom-preset",Le="disabled-bgfit",Se="disabled-gradients",Ee="disabled-modes",Ce="disabled-properties",$e="display-options",Ae="force-filesystem",Te="general-settings",Pe="last-config",Oe="last-dir",Ie="playlists",Me="playqueue",Re="sensitivity-presets",_e="pl_",De="10",Fe="101",qe="close",Be="open",He="No description",Ne="1",je="2",ze="alpha",Ue="nobg",We="barSp",Ke="imgfit",Ge="stereo",Ye="colormode",Je="fill",Xe="gradient",Ve="leds",Ze="line",Qe="lumi",et="mirror",tt="mode",at="outline",nt="peaks",ot="presets",st="radial",it="spin",lt="reflex",rt="round",ct="split",dt="bark",ut="log",ft=1,pt=-1,ht="config.json",mt={defaultAccessMode:ye,enableLocalAccess:!0,mediaPanel:Be},bt="D",gt=document.querySelector.bind(document),vt=document.querySelectorAll.bind(document),yt=gt("#alpha_bars"),kt=gt("#analyzer"),wt=gt("#ansi_bands"),xt=gt("#auto_hide"),Lt=gt("#background"),St=gt("#balance"),Et=gt("#bar_space"),Ct=gt("#bg_img_dim"),$t=gt("#bg_img_fit"),At=gt("#bg_location"),Tt=gt("#bg_max_items"),Pt=gt("#channel_layout"),Ot=gt("#color_mode"),It=gt("#bg_container"),Mt=gt("#bg_dim"),Rt=gt("#end_timeout"),_t=gt("#fft_size"),Dt=gt("#fill_alpha"),Ft=gt("#fps"),qt=gt("#freq_scale"),Bt=gt("#fs_height"),Ht=gt("#gradient"),Nt=gt("#gradientRight"),jt=gt("#info_timeout"),zt=gt("#led_display"),Ut=gt("#linear_amplitude"),Wt=gt("#line_width"),Kt=gt("#link_grads"),Gt=gt("#loaded_playlist"),Yt=gt("#lo_res"),Jt=gt("#lumi_bars"),Xt=gt("#max_fps"),Vt=gt("#files_panel"),Zt=gt("#mirror"),Qt=gt("#mode"),ea=gt("#mute"),ta=gt("#no_shadow"),aa=gt("#note_labels"),na=gt("#outline"),oa=gt("#osd"),sa=gt("#osd_font_size"),ia=gt("#pip_ratio"),la=gt("#playlists"),ra=gt("#radial"),ca=gt("#random_mode"),da=gt("#freq_max"),ua=gt("#freq_min"),fa=gt("#reflex"),pa=gt("#repeat"),ha=gt("#round_bars"),ma=gt("#save_dir"),ba=gt("#save_queue"),ga=gt("#scaleX"),va=gt("#scaleY"),ya=gt("#sensitivity"),ka=gt("#show_count"),wa=gt("#show_cover"),xa=gt("#show_peaks"),La=gt("#show_song"),Sa=gt("#smoothing"),Ea=gt("#source"),Ca=gt("#spin"),$a=gt("#split_grad"),Aa=gt("#toggle_console"),Ta=gt("#toggle_settings"),Pa=gt("#track_timeout"),Oa=gt("#video"),Ia=gt("#volume"),Ma=gt("#warp"),Ra=gt("#weighting"),_a=[{key:"demo",name:"Demo (random)",options:{randomMode:6}},{key:"bands",name:"Octave Bands",options:{alphaBars:0,ansiBands:0,background:J,barSpace:.25,bgImageDim:.3,bgImageFit:te,channelLayout:de,colorMode:ue,freqMax:2e4,freqMin:25,freqScale:ut,gradient:"rainbow",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"2",noteLabels:1,outlineBars:0,radial:0,randomMode:0,reflex:Ne,roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:bt}},{key:"ledbars",name:"Classic LED bars",options:{alphaBars:0,ansiBands:1,background:J,barSpace:.25,bgImageDim:.3,bgImageFit:ae,channelLayout:de,colorMode:ue,freqMax:2e4,freqMin:25,freqScale:ut,gradient:"classic",ledDisplay:1,linearAmpl:1,lumiBars:0,outlineBars:0,mirror:0,mode:"6",noteLabels:0,radial:0,randomMode:0,reflex:"0",roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:bt}},{key:"dual",name:"Dual-channel combined Graph, Bark frequency scale",options:{ansiBands:0,background:J,bgImageDim:.3,bgImageFit:ae,channelLayout:ce,colorMode:ue,fillAlpha:.3,freqMax:2e4,freqMin:20,freqScale:dt,gradient:"cool",gradientRight:"dusk",linearAmpl:1,lineWidth:1.5,linkGrads:0,mirror:0,mode:Fe,noteLabels:0,radial:0,randomMode:0,reflex:"0",showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:bt}},{key:"radial",name:"Radial Color by Level",options:{alphaBars:1,ansiBands:0,background:J,barSpace:.1,bgImageDim:.3,bgImageFit:oe,channelLayout:de,colorMode:pe,freqMax:2e4,freqMin:20,freqScale:ut,gradient:"prism",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"5",noteLabels:0,outlineBars:0,radial:1,randomMode:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,spin:1,splitGrad:0,weighting:bt}},{key:"round",name:"Round Bars reflex",options:{alphaBars:0,background:J,barSpace:.25,bgImageDim:.3,bgImageFit:ie,channelLayout:de,colorMode:fe,freqMax:2e4,freqMin:20,freqScale:ut,gradient:"apple",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"3",noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:je,roundBars:1,showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:bt}},{key:"last",name:"Last session",options:{}},{key:"default",name:"Restore defaults",options:{alphaBars:0,ansiBands:0,background:G,balance:0,barSpace:.1,bgImageDim:.5,bgImageFit:ae,channelLayout:de,colorMode:ue,fillAlpha:.1,freqMax:2e4,freqMin:20,freqScale:ut,gradient:"prism",gradientRight:"prism",ledDisplay:0,linearAmpl:0,lineWidth:2,linkGrads:0,loRes:0,lumiBars:0,micSource:0,mirror:0,mode:"0",mute:0,noShadow:1,noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:"0",repeat:0,roundBars:0,sensitivity:1,showFPS:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,spin:2,splitGrad:0,volume:1,weighting:""}}],Da={apple:{name:"Apple ][",colorStops:[{pos:.1667,color:"#61bb46"},{pos:.3333,color:"#fdb827"},{pos:.5,color:"#f5821f"},{pos:.6667,color:"#e03a3e"},{pos:.8333,color:"#963d97"},{pos:1,color:"#009ddc"}],disabled:!1},aurora:{name:"Aurora",bgColor:"#0e172a",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:1,color:"hsl( 216, 100%, 50% )"}],disabled:!1},borealis:{name:"Borealis",bgColor:"#0d1526",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:.5,color:"hsl( 189, 100%, 40% )"},{pos:1,color:"hsl( 290, 60%, 40% )"}],disabled:!1},candy:{name:"Candy",bgColor:"#0d0619",colorStops:[{pos:.1,color:"#ffaf7b"},{pos:.5,color:"#d76d77"},{pos:1,color:"#3a1c71"}],disabled:!1},classic:{name:"Classic",disabled:!1},cool:{name:"Cool",bgColor:"#0b202b",colorStops:["hsl( 208, 0%, 100% )","hsl( 208, 100%, 35% )"],disabled:!1},dusk:{name:"Dusk",bgColor:"#0e172a",colorStops:[{pos:.2,color:"hsl( 55, 100%, 50% )"},{pos:1,color:"hsl( 16, 100%, 50% )"}],disabled:!1},miami:{name:"Miami",bgColor:"#110a11",colorStops:[{pos:.024,color:"rgb( 251, 198, 6 )"},{pos:.283,color:"rgb( 224, 82, 95 )"},{pos:.462,color:"rgb( 194, 78, 154 )"},{pos:.794,color:"rgb( 32, 173, 190 )"},{pos:1,color:"rgb( 22, 158, 95 )"}],disabled:!1},orient:{name:"Orient",bgColor:"#100",colorStops:[{pos:.1,color:"#f00"},{pos:1,color:"#600"}],disabled:!1},outrun:{name:"Outrun",bgColor:"#101",colorStops:[{pos:0,color:"rgb( 255, 223, 67 )"},{pos:.182,color:"rgb( 250, 84, 118 )"},{pos:.364,color:"rgb( 198, 59, 243 )"},{pos:.525,color:"rgb( 133, 80, 255 )"},{pos:.688,color:"rgb( 74, 104, 247 )"},{pos:1,color:"rgb( 35, 210, 255 )"}],disabled:!1},pacific:{name:"Pacific Dream",bgColor:"#051319",colorStops:[{pos:.1,color:"#34e89e"},{pos:1,color:"#0f3443"}],disabled:!1},prism:{name:"Prism",disabled:!1},prism_old:{name:"Prism (legacy)",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )"],disabled:!0},rainbow:{name:"Rainbow",disabled:!1},rainbow_old:{name:"Rainbow (legacy)",dir:"h",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 47% )","hsl( 240, 100%, 58% )","hsl( 300, 100%, 50% )","hsl( 360, 100%, 50% )"],disabled:!0},shahabi:{name:"Shahabi",bgColor:"#060613",colorStops:[{pos:.1,color:"#66ff00"},{pos:1,color:"#a80077"}],disabled:!1},summer:{name:"Summer",bgColor:"#041919",colorStops:[{pos:.1,color:"#fdbb2d"},{pos:1,color:"#22c1c3"}],disabled:!1},sunset:{name:"Sunset",bgColor:"#021119",colorStops:[{pos:.1,color:"#f56217"},{pos:1,color:"#0b486b"}],disabled:!1},tiedye:{name:"Tie Dye",colorStops:[{pos:.038,color:"rgb( 15, 209, 165 )"},{pos:.208,color:"rgb( 15, 157, 209 )"},{pos:.519,color:"rgb( 133, 13, 230 )"},{pos:.731,color:"rgb( 230, 13, 202 )"},{pos:.941,color:"rgb( 242, 180, 107 )"}],disabled:!1}},Fa=[{value:"0",text:"Discrete frequencies",disabled:!1},{value:De,text:"Area graph",disabled:!1},{value:Fe,text:"Line graph",disabled:!1},{value:"8",text:"Octave bands / 10 bands",disabled:!1},{value:"7",text:"1/2 octave / 20 bands",disabled:!1},{value:"6",text:"1/3 octave / 30 bands",disabled:!1},{value:"5",text:"1/4 octave / 40 bands",disabled:!1},{value:"4",text:"1/6 octave / 60 bands",disabled:!1},{value:"3",text:"1/8 octave / 80 bands",disabled:!1},{value:"2",text:"1/12 octave / 120 bands",disabled:!1},{value:"1",text:"1/24 octave / 240 bands",disabled:!1}],qa=[[de,"Singl"],[ce,"Comb"],["dual-horizontal","Horiz"],["dual-vertical","Vert"]],Ba=[{value:ze,text:"Alpha",disabled:!1},{value:tt,text:"Analyzer Mode",disabled:!1},{value:Ue,text:"Background",disabled:!1},{value:We,text:"Bar Spacing",disabled:!1},{value:Ke,text:"BG Image Fit",disabled:!1},{value:Ge,text:"Channel Layout",disabled:!1},{value:Ye,text:"Color Mode",disabled:!1},{value:Je,text:"Fill Opacity",disabled:!1},{value:Xe,text:"Gradients",disabled:!1},{value:Ve,text:"LEDs",disabled:!1},{value:Ze,text:"Line Width",disabled:!1},{value:Qe,text:"Lumi",disabled:!1},{value:et,text:"Mirror",disabled:!1},{value:at,text:"Outline",disabled:!1},{value:nt,text:"Peaks",disabled:!1},{value:st,text:"Radial",disabled:!1},{value:it,text:"Radial Spin",disabled:!1},{value:lt,text:"Reflex",disabled:!1},{value:rt,text:"Round",disabled:!1},{value:ct,text:"Split",disabled:!1},{value:ot,text:"User Presets",disabled:!0}],Ha=[{min:-70,max:-20,boost:1},{min:-85,max:-25,boost:1.6},{min:-100,max:-30,boost:2.4}],Na={info:5,track:10,end:10,covers:!0,count:!0},ja=[{value:te,text:"Adjust",disabled:!1},{value:ae,text:"Center",disabled:!1},{value:oe,text:"Pulse",disabled:!1},{value:ne,text:"Repeat",disabled:!1},{value:se,text:"Warp",disabled:!1},{value:ie,text:"Warp Drive",disabled:!1},{value:le,text:"Wormhole",disabled:!1},{value:"4",text:"Zoom In",disabled:!1},{value:"5",text:"Zoom Out",disabled:!1}],za=[xt,At,Tt,_t,Bt,Xt,sa,ia,ma,ba,Sa],Ua={autoHide:!0,bgLocation:Q,bgMaxItems:20,fftSize:8192,osdFontSize:"1",fsHeight:100,maxFPS:60,pipRatio:2.35,saveDir:!0,saveQueue:!0,smoothing:.7},Wa=[[30,"30"],[60,"60"],[0,"unlimited"]],Ka=[[1,"1:1"],[1.33,"4:3"],[1.78,"16:9"],[2.35,"2.35:1"],[3.55,"32:9"]];let Ga,Ya,Ja,Xa,Va,Za,Qa,en,tn,an,nn,on,sn,ln,rn,cn,dn,un,fn,pn,hn,mn,bn,gn,vn,yn,kn,wn,xn,Ln=[],Sn=[],En=[],Cn=null,$n={},An=!1,Tn=!1,Pn=!1,On=0;const In=oa.getContext("2d"),Mn=new Image,Rn=document.createElement("video"),_n=(e,t)=>e.replace(/(%2f|\/)/g,t&&q?"\\":"/"),Dn=e=>e.replace(/\//g,"%2f"),Fn=e=>Math.round(100*e)/100,qn=e=>{if(!e)return;let t=0;for(;e=e.previousElementSibling;)t++;return t},Bn=e=>{let t="";if(Yn(e)){const a=e.querySelector(":checked ~ label");a&&(t=a.textContent)}else t=e[e.selectedIndex].text;return t},Hn=e=>Yn(e)?e.elements[e.dataset.prop].value:void 0!==e.dataset.active?e.dataset.active:e.value,Nn=e=>({alphaBars:Hn(yt),ansiBands:Hn(wt),background:Hn(Lt),barSpace:Hn(Et),bgImageDim:Hn(Ct),bgImageFit:Hn($t),channelLayout:Hn(Pt),colorMode:Hn(Ot),fillAlpha:Hn(Dt),freqMax:Hn(da),freqMin:Hn(ua),freqScale:Hn(qt),gradient:Hn(Ht),gradientRight:Hn(Nt),ledDisplay:Hn(zt),linearAmpl:Hn(Ut),lineWidth:Hn(Wt),linkGrads:Hn(Kt),loRes:Hn(Yt),lumiBars:Hn(Jt),mirror:Hn(Zt),mode:Hn(Qt),noShadow:Hn(ta),noteLabels:Hn(aa),outlineBars:Hn(na),radial:Hn(ra),randomMode:Hn(ca),reflex:Hn(fa),repeat:Hn(pa),roundBars:Hn(ha),sensitivity:Hn(ya),showFPS:Hn(Ft),showPeaks:Hn(xa),showScaleX:Hn(ga),showScaleY:Hn(va),showSong:Hn(La),spin:Hn(Ca),splitGrad:Hn($a),weighting:Hn(Ra)}),jn=e=>{const t=+e==e?e:_a.findIndex((t=>t.key==e));return t<0||t>_a.length-1?-1:t},zn=e=>{const t=jn(e);return-1==t?{}:_a[t].options},Un=e=>{const t=jn(e);return-1!=t&&_a[t].name},Wn=()=>{const e=Hn(Pt)!=de&&!Qn(Kt);return`Gradient${e?"s":""}: ${Da[Ht.value].name+(e?" / "+Da[Nt.value].name:"")}`},Kn=()=>rn.map(((e,t)=>`<strong>[${t+1}]</strong>&nbsp; ${Xn(e)?'<em class="empty">Empty slot</em>':e.name||He}`)),Gn=e=>e.startsWith("blob:"),Yn=e=>"FORM"==e.tagName&&null!=e.dataset.prop,Jn=e=>e.startsWith("http")&&!e.startsWith(j),Xn=e=>!e||"object"!=typeof e||!Object.keys(e).length,Vn=e=>It.classList.contains("pip"),Zn=(e=Ln[Ja])=>e&&e.currentTime>0&&!e.paused&&!e.ended,Qn=e=>"1"==e.dataset.active,eo=()=>ve.includes(no(Ln[Ja].dataset.file).extension),to=e=>"string"==typeof e?e.replace(/\\/g,"/"):e,ao=e=>Qn(e)?"ON":"OFF",no=e=>{if("string"!=typeof e)return{};const t=ro(e),a=t.lastIndexOf("/")+1,n=t.slice(0,a),o=t.slice(a),s=o.lastIndexOf("."),i=s>=0?o.slice(0,s):o,l=s>=0?o.slice(s+1).toLowerCase():"";return{path:n,fileName:o,baseName:i,extension:l}},oo=e=>{e=e.replace(/_/g," ");const[,,t,a,,n,o]=e.match(/(^(-?\d+)([,\.\-\s]))?((.*?)\s+-\s+)?(.*)/);return{artist:n,title:o,duration:","==a?uo(t):""}},so=e=>(F&&!Jn(e)&&(e.startsWith(B)&&(e=e.slice(9)),e=B+Dn(e)),e),io=e=>tn.children.length,lo=(e=2)=>Math.random()*e|0,ro=e=>{const t=new RegExp(`^${B}`);return to(_n(e.replace(t,"")))},co=e=>{ln?(0,M.hZ)(Oe,e):on!=pt&&os(Oe,e)},uo=e=>{if(e==1/0||-1==e)return"LIVE";let t="",a="";return e>=3600&&(t=(e/3600|0)+":",e%=3600,a="0"),t+=(a+(e/60|0)).slice(-2)+":"+("0"+(e%60|0)).slice(-2),t},fo=(e,t,a,n=1)=>{e.min=t,e.max=a,e.step=n};function po(e,t=!1){const a=e.map((e=>bo(e,t)));Promise.all(a).then((e=>{const t=e.reduce(((e,t)=>e+t),0),a=`${t} song${t>1?"s":""} added to the queue${io()<K?"":". Queue is full!"}`;D().alert({text:a,time:5}),xs(!0)}))}function ho(e,t){const a=t.dataset,n=e.dataset,o=e.common,s=e.format;if(n)Object.assign(a,n);else if(a.artist=o.artist||a.artist,a.title=o.title||a.title,a.album=o.album?o.album+(o.year?" ("+o.year+")":""):"",a.codec=s?s.codec||s.container:a.codec,s&&(s.bitsPerSample||s.sampleRate&&!s.bitrate)?a.quality=(s.sampleRate?(s.sampleRate/1e3|0)+"KHz":"")+(s.sampleRate&&s.bitsPerSample?" / ":"")+(s.bitsPerSample?s.bitsPerSample+"bits":""):s&&s.bitrate?a.quality=(s.bitrate/1e3|0)+"K "+(s.codecProfile||""):a.quality="",s&&s.duration?a.duration=uo(s.duration):a.duration="",o.picture&&o.picture.length){const e=new Blob([o.picture[0].data],{type:o.picture[0].format});a.cover=URL.createObjectURL(e)}t==Ln[Ja]&&ds()}function mo(e,t){return new Promise((a=>{if(io()>=K)return void a(0);const{fileName:n,baseName:o,extension:s}=no(function(e){return e.replace(/%2[356]/g,(e=>({"%23":"#","%25":"%","%26":"&"}[e])))}(e.file)),i=to(e.file),l=document.createElement("li"),r=l.dataset;Object.assign(r,re),t||(t=oo(o)),r.artist=t.artist||"",r.title=t.title||n||i.slice(i.lastIndexOf("//")+2),r.duration=t.duration||"",r.codec=s.toUpperCase(),r.file=i,l.handle=e.handle,tn.appendChild(l),!me.includes(s)&&s||(r.retrieve=1,Qo()),1!=io()||Zn()?a(1):qo(0).then((()=>a(1))),an>io()-3&&Ro()}))}function bo(e,t=!1){let a;return a=ge.includes(no(e.file).extension)?_o(e):mo(e),a.then((e=>{t&&!Zn()&&e>0&&zo(io()-e)})),a}function go(e){let t=e?Fn((+St.dataset.value||0)+.1*e):0;t<-1?t=-1:t>1&&(t=1),rs(t),cs("Balance: "+(0==t?"CENTER":100*Math.abs(t)+"% "+(t>0?"Right":"Left"))),Ps()}function vo(e){const t=+Bt.value;(1==e&&t<+Bt.max||-1==e&&t>+Bt.min)&&(Bt.value=t+Bt.step*e,ms(Bt)),cs(`Analyzer height: ${Bt.value}%`)}function yo(e){let t=Fn((+Ia.dataset.value||0)+.05*e);t<0?t=0:t>1&&(t=1),gs(t),cs("Volume: "+20*t),Ps()}function ko(e=Ja){const t=Ln[e],a=t.dataset;Oo(t,null),Object.assign(a,re),t.load(),e==Ja&&ds()}function wo(e=Ga){const t=e.pixelRatio,a=oa.height=It.clientHeight*t,n=oa.width=It.clientWidth*t;dn=Math.max(12,Math.min(n,a)/[24,17,13.5][+sa.value]),un=3*dn,fn=n/2,pn=n-dn,hn=1.4*dn,mn=1.8*hn,yn=n/3-dn,bn=a-4*dn,gn=a-2.8*dn,vn=a-1.6*dn,kn=n-8*dn,wn=`bold ${.7*dn}px sans-serif`,xn=`bold ${dn}px sans-serif`}function xo(e,t,a){const n=gt("#console-content"),o=new Date,s=o.toLocaleTimeString([],{hour12:!1})+"."+String(o.getMilliseconds()).padStart(3,"0");a&&(n.innerHTML=""),t&&gt("#toggle_console").classList.add("warning"),e&&(n.innerHTML+=`<div ${t?'class="error"':""}>${s} &gt; ${e}</div>`),n.scrollTop=n.scrollHeight}function Lo(e,t){const a=Yn(e)?e.elements[e.dataset.prop]:e.options;let n=(Yn(e)?Array.from(a).findIndex((e=>e.checked)):e.selectedIndex)+(t?-1:1);n<0?n=a.length-1:n>=a.length&&(n=0),Yn(e)?a[n].checked=!0:e.selectedIndex=n,ms(e)}function So(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Eo(){Cn&&Cn.key&&(delete Da[Cn.key],0===Object.keys(Da).filter((e=>!Da[e].disabled)).length&&(Da[Object.keys(Da)[0]].disabled=!1),Go(),Ko(),ns(we),ns(Se),Cn=null,location.href="#config")}function Co(e,t){if(Xn(rn[e]))return;const a=`User Preset #${e+1}`,n=rn[e].name?"<br>"+rn[e].name:"";t?(rn[e]={},os(xe,rn),D().alert({text:`Deleted ${a}`})):D().confirm({text:`Do you really want to DELETE ${a}?${n}<br>THIS CANNOT BE UNDONE!`,submitText:"DELETE",submitCallback:()=>{Co(e,!0)},cancelCallback:()=>{D().alert({text:"Canceled!"})}})}function $o(e=1){const t=Ln[Ja];if(t.duration>0&&t.duration<1/0){let a=t.currentTime+5*e;a<0?a=0:a>t.duration-1&&(a=t.duration-1),cs(1),t.currentTime=a}"m"==An&&is("m",e)}function Ao(){return clearTimeout(Xa),!!An&&(An=!1,!0)}async function To(){Vn()&&await document.exitPictureInPicture(),Ga.toggleFullscreen(),document.activeElement.blur()}function Po(e){if("F1"==e.code&&!e.altKey&&!e.ctrlKey)return location.href="#help",void e.preventDefault();if("BODY"!=e.target.tagName||e.altKey||e.ctrlKey)return;const t=e.shiftKey;if("keydown"==e.type)switch(e.code){case"ArrowUp":t?vo(1):yo(1);break;case"ArrowDown":t?vo(-1):yo(-1);break;case"ArrowLeft":t?go(-1):An?(cs("Rewind",1),$o(-1)):is("k",-1);break;case"ArrowRight":t?go(1):An?(cs("Fast forward",1),$o()):is("k");break;default:return}else if(e.code.match(/^(Digit|Numpad)[0-9]$/)){const a=e.code.slice(-1)-1;if(-1==a)t||(Jo(!0),ms(ca,!1));else if(t){const e=Nn();e.randomMode=0,ss(a,e)}else Do(a)}else switch(e.code){case"Delete":case"Backspace":tn.querySelectorAll(".selected").forEach((e=>{es(e),e.remove()}));const e=qn(tn.querySelector(".current"));void 0!==e?an=e:an>io()-1?an=io()-1:an--,io()?Ro():(ko(Qa),Zn()||ko()),xs(!0);break;case"Space":cs(Zn()?"Pause":"Play",1),No();break;case"ArrowLeft":case"KeyJ":Ao()||t||(cs("Previous track",1),ks(!0));break;case"KeyG":Lo(Ht,t),cs(Wn());break;case"ArrowRight":case"KeyK":Ao()||t||(cs("Next track",1),ks());break;case"KeyA":Lo(ca,t),cs("Randomize: "+Bn(ca)),ms(ca);break;case"KeyB":Lo(t?$t:Lt);const a=Lt.value[0];cs("Background: "+Bn(Lt)+(a>1&&a<7?` (${Bn($t)})`:""));break;case"KeyC":ra.click(),cs("Radial "+ao(ra));break;case"KeyD":Cs();break;case"KeyE":io()>0&&(ys(),cs("Shuffle"));break;case"KeyF":To();break;case"KeyH":Ft.click();break;case"KeyI":La.click(),cs("Song info display "+ao(La));break;case"KeyL":zt.click(),cs("LED effect "+ao(zt));break;case"KeyM":case"KeyV":Lo(Qt,t),cs("Mode: "+Bn(Qt));break;case"KeyN":Lo(ya,t),cs(Bn(ya).toUpperCase()+" sensitivity");break;case"KeyO":Yt.click(),cs((Qn(Yt)?"LOW":"HIGH")+" Resolution");break;case"KeyP":xa.click(),cs("Peaks "+ao(xa));break;case"KeyR":pa.click(),cs("Queue repeat "+ao(pa));break;case"KeyS":cs("Scale: "+["None","Frequency (Hz)","Level (dB)","Both"][function(e){let t=+ga.dataset.active+(va.dataset.active<<1)+(e?-1:1);return t<0?t=3:t>3&&(t=0),ga.dataset.active=1&t,va.dataset.active=t>>1,ms([ga,va]),t}(t)]);break;case"KeyT":ta.click(),cs((Qn(ta)?"Flat":"Shadowed")+" text mode");break;case"KeyU":Jt.click(),cs("Luminance bars "+ao(Jt));break;case"KeyX":Lo(fa,t),cs("Reflex: "+Bn(fa));break;default:return}e.preventDefault()}function Oo(e,t){const a=e.src||"";Gn(a)&&URL.revokeObjectURL(a),t?e.src=t:e.removeAttribute("src"),hs()}function Io(e,t,a){return new Promise((n=>{const o=URL.createObjectURL(e);Oo(t,o),t.onloadeddata=()=>{a&&t.play(),t.onloadeddata=null,n(o)}}))}async function Mo(e){return JSON.parse(F?await electron.api("storage-get",e):localStorage.getItem(e))}async function Ro(){const e=an<io()-1?an+1:0,t=tn.children[e],a=Ln[Qa];t&&(ho(t,a),t.handle?(await t.handle.requestPermission(),t.handle.getFile().then((e=>Io(e,a))).then((()=>a.load()))):(Oo(a,t.dataset.file),a.load())),Pn=!1}function _o(e){let t=to(e.file);return new Promise((async a=>{let n=[];const o=()=>{Promise.all(n).then((e=>{const t=e.reduce(((e,t)=>e+t),0);a(t)}))},s=async e=>{let a;Gt.dataset.path||ps(t),t=no(t).path;for(let o of e.split(/[\r\n]+/))if("#"!=o.charAt(0)&&""!=o.trim()){let e;o=to(o),a||(a=no(o).baseName),Jn(o)||(ln&&(e=await A(o),e||xo(`Cannot resolve file handle for ${o}`,!0)),o=E(o),":"!=o[1]&&"/"!=o[0]&&(o=t+o)),n.push(mo({file:so(o),handle:e},oo(a))),a=""}else o.startsWith("#EXTINF")&&(a=o.slice(8));o()};if(t)if("string"==typeof t&&ge.includes(no(t).extension))e.handle?e.handle.getFile().then((e=>e.text())).then(s).catch((e=>{xo(e,!0),a(0)})):fetch(t).then((e=>{if(200==e.status)return e.text();xo(`Fetch returned error code ${e.status} for URI ${t}`,!0)})).then(s).catch((e=>{xo(e,!0),a(0)}));else{const e=await(0,M.Jt)(!0===t?Me:_e+t);Array.isArray(e)?(e.forEach((e=>{const t=to(e.file),a=e.handle;n.push(mo({file:t,handle:a}))})),o()):(!0!==t&&xo(`Unrecognized playlist file: ${t}`,!0),a(0))}else a(-1)}))}function Do(e,t=!0,a,n){const o=+e==e,s=o?rn[e].options:zn(e),i=zn("default");Xn(s)||(t&&xo("Loading "+(o?"User Preset #"+(e+1):"'"+Un(e)+"' preset")),void 0!==s.stereo&&(s.channelLayout=qa[+s.stereo][0]),vt("[data-prop]").forEach((e=>{const t=e.dataset.prop,o=void 0!==s[t]?s[t]:a?i[t]:void 0;if(void 0!==o&&(e!=ca||!n))if(Yn(e)){const t=e.querySelector(`[value="${o}"]`);t&&(t.checked=!0)}else e.classList.contains("switch")?e.dataset.active=+o:e==St?rs(o):e==ea?As(o):e==Ea?bs(o):e==Ia?gs(o):(e.value=o,-1==e.selectedIndex&&(e.selectedIndex=0),Os(e))})),Ga.setOptions({alphaBars:Qn(yt),ansiBands:Qn(wt),colorMode:Hn(Ot),fftSize:Hn(_t),frequencyScale:Hn(qt),ledBars:Qn(zt),linearAmplitude:Qn(Ut),loRes:Qn(Yt),lumiBars:Qn(Jt),maxFPS:Hn(Xt),maxFreq:Hn(da),minFreq:Hn(ua),mirror:Hn(Zt),noteLabels:Qn(aa),outlineBars:Qn(na),radial:Qn(ra),roundBars:Qn(ha),showFPS:Qn(Ft),showPeaks:Qn(xa),showScaleX:Qn(ga),showScaleY:Qn(va),smoothing:Hn(Sa),spinSpeed:Hn(Ca),splitGradient:Qn($a),weightingFilter:Hn(Ra)}),ms([Lt,$t,Ct,Pt,Bt,Kt,ya,fa,Ht,Nt,...n?[]:[ca],Et,Qt]),"demo"==e&&Jo(!0),t&&D().alert({text:"Settings loaded!"}))}async function Fo(e){So(la);const t=new Option("Select a playlist","");t.disabled=!0,t.selected=!0,la.options[la.options.length]=t;let a=await(0,M.Jt)(Ie);const n=await Mo(Ie);if(n){for(const e of Object.keys(n)){const t=_e+e,o=await Mo(t);let s=[];for(const e of o)s.push({file:e});await(0,M.hZ)(t,s),Xo(t),a[e]=n[e]}await(0,M.hZ)(Ie,a),Xo(Ie)}if(a)for(const t of Object.keys(a)){const n=new Option(a[t],t);n.dataset.isLocal="1",t==e&&(n.selected=!0),la.options[la.options.length]=n}fetch("playlists.cfg").then((e=>200==e.status&&(xo("Found legacy playlists.cfg file"),e.text()))).then((e=>{if(!1!==e){let t=0;e.split(/[\r\n]+/).forEach((e=>{if("#"!=e.charAt(0)&&""!=e.trim()){let a=e.split(/\|/);2==a.length&&(la.options[la.options.length]=new Option(a[0].trim(),a[1].trim()),t++)}})),t?xo(`${t} playlists loaded from playlists.cfg`):xo("No playlists found in playlists.cfg",!0)}})).catch((e=>{}))}function qo(e,t){return new Promise((async a=>{const n=Ln[Ja],o=()=>{$s(),Ro(),a(!0)};if(tn.children[e]){an=e;const a=tn.children[an];ho(a,n),a.handle?(await a.handle.requestPermission(),a.handle.getFile().then((e=>Io(e,n,t))).then((()=>o()))):(Oo(n,a.dataset.file),n.onloadeddata=()=>{t&&n.play(),n.onloadeddata=null,o()})}else a(!1)}))}function Bo(){Cn={name:"New Gradient",bgColor:"#111111",colorStops:[{pos:.1,color:"#222222"},{pos:1,color:"#eeeeee"}],disabled:!1,key:"custom-gradient-1"};let e=2;for(;Object.keys(Da).some((e=>e===Cn.key))&&e<10;)Cn.key=`custom-gradient-${e}`,e++;Vo(),gt("#btn-save-gradient").innerText="Add",gt("#btn-delete-gradient").style.display="none",location.href="#gradient-editor"}function Ho(e){if(Pn||Ea.checked||an>io()-1)return!0;if(Pn=!0,an<io()-1)an++;else{if(!Qn(pa))return Pn=!1,!1;an=0}return e|=Zn(),[Ja,Qa]=[Qa,Ja],hs(),ds(),e?Ln[Ja].play().then((()=>Ro())).catch((e=>{e.code!=he&&(xo(e,!0),Ro(),Ho(!0))})):Ro(),$s(),!0}function No(e){Ea.checked||(Zn()&&!e?(Ln[Ja].pause(),Vn()&&Rn.pause()):Ln[Ja].play().catch((e=>{e.code!=he&&(xo(e,!0),Ho(!0))})))}function jo(){let e=!0;return Zn()?Ln[Ja].currentTime>2?Ln[Ja].currentTime=0:an>0?zo(an-1):e=!1:e=qo(an-1),e}function zo(e){qo(e,!0)}function Uo(){let e=[{value:J,text:"Album cover"},{value:Y,text:"Black"},{value:G,text:"Gradient default"}];const t=e.length,a=Sn.length,n=En.length;e=[...e,...Sn.map(((e,t)=>({value:X+e.name,text:"🖼️ "+e.name,idx:t}))),...En.map(((e,t)=>({value:V+e.name,text:"🎬 "+e.name,idx:t})))].slice(0,t+ +Tt.value),n&&e.splice(t,0,{value:V,text:"Random video"}),a&&e.splice(t,0,{value:X,text:"Random image"}),Yo(Lt,e)}function Wo(e,t){const a=!Array.isArray(t[0]);for(const n of a?t.filter((e=>!e.disabled)):t){const t=e.dataset.prop,a=n.text||n[1],o=n.value||n[0],s=t+"-"+o,i=document.createElement("input"),l=document.createElement("label");i.name=t,i.id=s,i.type="radio",i.value=o,l.htmlFor=s,l.innerText=a,e.append(i,l)}}function Ko(){const e=gt("#enabled_gradients");So(e),Object.keys(Da).forEach((t=>{t.startsWith("custom")?e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${Da[t].disabled?"":"checked"}>\n                   <a href="#" data-grad="${t}" class="grad-edit-link">${Da[t].name}</a>\n                </label>`:e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${Da[t].disabled?"":"checked"}>\n                   ${Da[t].name}\n                </label>`})),vt(".enabledGradient").forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&Object.keys(Da).reduce(((e,t)=>e+!Da[t].disabled),0)<2)return D().alert({text:"At least one Gradient must be enabled!"}),t.preventDefault(),!1;Da[e.dataset.grad].disabled=!e.checked,Go(),ns(Se)}))})),vt(".grad-edit-link").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),function(e){if(!Da[e])throw new Error(`gradients[${e}] is null or undefined.`);const t=Da[e],a={};a.name=t.name,a.bgColor=t.bgColor,a.dir=t.dir,a.disabled=t.disabled,a.key=e,a.colorStops=[];for(const e of t.colorStops)a.colorStops.push({...e});Cn=a}(e.target.getAttribute("data-grad")),Vo(),gt("#btn-save-gradient").innerText="Save",gt("#btn-delete-gradient").style.display="block",location.href="#gradient-editor"}))}))}function Go(){for(const e of[Ht,Nt]){let t=e.value;So(e);for(const t of Object.keys(Da))Da[t].disabled||(e.options[e.options.length]=new Option(Da[t].name,t));""!==t&&(e.value=t,ms(e))}}function Yo(e,t){const a=e.value;Array.isArray(t)||(t=[t]),So(e);for(const a of t.filter((e=>e&&!e.disabled))){const t=new Option(a.text||a[1],a.value||a[0]);null===a[0]&&(t.disabled=!0),void 0!==a.idx&&(t.idx=a.idx),e[e.options.length]=t}""!==a&&(e.value=a,-1==e.selectedIndex&&(e.selectedIndex=0),ms(e))}function Jo(e=Ea.checked){if(!Zn()&&!e)return;const t=e=>!Ba.find((t=>t.value==e)).disabled,a=(e,t=!0,a=(()=>!0))=>{let o=9;do{if(Yn(e)){const t=e.elements[e.dataset.prop];t[lo(t.length)].checked=!0}else if(void 0!==e.dataset.active)e.dataset.active=lo();else if(e.step){const{min:t,max:a,step:n}=e,o=lo((a-t)/n+1)*n+ +t;e.value=(10*o|0)/10,Os(e)}else e.selectedIndex=lo(e.options.length)}while(!a(Hn(e))&&o--);t&&n.push(e)};let n=[];if(t(ot)){const e=rn.map(((e,t)=>Xn(e)?null:t)).filter((e=>null!==e)),t=e.length;t&&Do(e[lo(t)],!1,!1,!0)}if(t(tt)&&a(Qt),t(ze)&&a(yt),t(Ue)&&a(Lt,!1),t(Ke)&&a($t),t(Ge)&&a(Pt,!0,(e=>e!=ce)),t(Ye)&&a(Ot),t(nt)&&a(xa),t(Ve)&&a(zt),t(Qe)&&a(Jt,!0,(e=>!e||Lt.value[0]<=1||!Qn(zt))),t(Ze)&&a(Wt,!1),t(Je)&&a(Dt,!1),t(We)&&a(Et,!1),t(at)&&a(na),t(lt)&&a(fa,!1,(e=>e!=je||!Qn(zt))),t(st)&&a(ra),t(rt)&&a(ha),t(it)&&a(Ca),t(ct)&&a($a),t(et)&&a(Zt),t(Xe))for(const e of[Ht,...Qn(Kt)?[]:[Nt]])a(e);n.push(Lt,fa,Qt),ms(n)}function Xo(e){F?electron.api("storage-remove",e):localStorage.removeItem(e)}function Vo(){if(null==Cn)throw new Error("Current gradient must be set before editing gradient");const e=gt("#grad-color-table");So(e),gt("#new-gradient-name").value=Cn.name,gt("#new-gradient-horizontal").checked="h"===Cn.dir;const t=gt("#grad-row-label-template").cloneNode(!0);t.removeAttribute("id"),e.appendChild(t),Cn.colorStops.forEach(((e,t)=>{!function(e,t){const a=gt("#grad-color-table"),n=gt("#grad-row-template").cloneNode(!0),o=n.querySelector(".grad-color-picker"),s=n.querySelector(".grad-color-value"),i=n.querySelector(".grad-color-stop"),l=n.querySelector(".grad-add-stop"),r=n.querySelector(".grad-remove-stop");o.value=t.color,s.value=t.color,i.value=t.pos,o.addEventListener("input",(t=>{s.value=t.target.value,Cn.colorStops[e].color=o.value})),s.addEventListener("input",(t=>{o.value=t.target.value,Cn.colorStops[e].color=o.value})),i.addEventListener("input",(t=>{Cn.colorStops[e].pos=parseFloat(t.target.value)})),l.addEventListener("click",(()=>{Cn.colorStops.splice(e+1,0,{pos:(()=>{if(e===Cn.colorStops.length-1){const e=Cn.colorStops[Cn.colorStops.length-1].pos;return Cn.colorStops[Cn.colorStops.length-1].pos=(Cn.colorStops[Cn.colorStops.length-2].pos+e)/2,e}return(Cn.colorStops[e].pos+Cn.colorStops[e+1].pos)/2})(),color:"#111111"}),Vo()})),2===Cn.colorStops.length?r.setAttribute("disabled","true"):r.addEventListener("click",(()=>{Cn.colorStops.splice(e,1),Vo()})),n.removeAttribute("id"),a.appendChild(n)}(t,Cn.colorStops[t])})),gt("#new-gradient-bkgd").value=Cn.bgColor}async function Zo(){const e=At.value,t=new RegExp("\\.("+be.join("|")+")$","i"),a=new RegExp("\\.("+ve.join("|")+")$","i");if(Sn=[],En=[],e==Q)try{const e=await fetch(U),n=await e.text();for(const{url:e,file:o}of T(n)){const n=no(o).baseName;t.test(o)?Sn.push({name:n,url:U+"/"+e}):a.test(o)&&En.push({name:n,url:U+"/"+e})}}catch(e){}else if(e==ee){const e=await(0,M.Jt)(ke);try{if(e)for await(const[n,o]of e.entries())if(o instanceof FileSystemFileHandle){const e=t.test(n),s=a.test(n);if(e||s){const t=await o.getFile(),a=URL.createObjectURL(t);e?Sn.push({name:n,url:a}):En.push({name:n,url:a})}}}catch(e){}}if(e!=Z){const e=Sn.length,t=En.length;xo("Found "+(e+t==0?"no media":e+" image files and "+t+" video")+" files in the backgrounds folder")}Uo()}async function Qo(){if(On>=W)return;const e=Array.from(tn.children).find((e=>e.dataset.retrieve));if(e){let t=e.dataset.file,a=!1;On++,delete e.dataset.retrieve;e:{if(e.handle){if("granted"!=await e.handle.requestPermission())break e;t=URL.createObjectURL(await e.handle.getFile()),a=!0}try{const a=await I.WC(t,{skipPostHeaders:!0});a&&(ho(a,e),Ls(e),e.handle||a.common.picture&&a.common.picture.length||function(e){return new Promise((t=>{const a=no(e).path;if(on==pt||Jn(e))t("");else if(void 0!==$n[a])t(so(a+$n[a]));else{const e=on==ft?H+Dn(a):a;fetch(e).then((e=>200==e.status?e.text():null)).then((e=>{let n="";if(e)if(on==ft)n=e;else{const t=P(e);t.cover&&(n=t.cover)}$n[a]=n,t(so(a+n))}))}}))}(t).then((t=>{e.dataset.cover=t,Ls(e)})))}catch(e){}a&&URL.revokeObjectURL(t)}On--,Qo()}}function es(e){const t=e.dataset.cover;Gn(t)&&URL.revokeObjectURL(t)}function ts(){null!==Cn&&(Da[Cn.key]=Cn,Ga.registerGradient(Cn.key,Cn),Go(),Ko(),ns(we),Cn=null,location.href="#config")}function as(e,t){if(0==io())return void D().alert({text:"Queue is empty!"});if(!e)return void D().input({text:"Playlist will be saved to the current folder.<br>Enter filename:",submitText:"Save",submitCallback:e=>{e?as(C(e,!0)):D().alert({text:"Canceled"})},cancelCallback:()=>{D().alert({text:"Canceled"})}});const a=[];tn.childNodes.forEach((e=>{const{file:t,artist:n,title:o,duration:s}=e.dataset;a.push({file:ro(t),artist:n,title:o,duration:s})})),fetch(N+e,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:a})}).then((e=>200==e.status?e.json():{error:`Cannot save file (ERROR ${e.status})`})).then((({file:e,error:a})=>{const n=e?`${t?"Updated":"Saved as"} ${no(e).fileName}`:a;D().alert({text:n}),ps(e),S(null,m.scrollTop)}))}function ns(e){const t=e=>e.map((({value:e,disabled:t})=>({value:e,disabled:t})));if(e&&e!=Ee||os(Ee,t(Fa)),e&&e!=Le||os(Le,t(ja)),e&&e!=Se||os(Se,Object.keys(Da).map((e=>({value:e,disabled:Da[e].disabled})))),!e||e==we){const e={};Object.keys(Da).filter((e=>e.startsWith("custom"))).forEach((t=>e[t]=Da[t])),os(we,e)}if(e&&e!=Ce||os(Ce,t(Ba)),!e||e==Re){let e=[];for(const t of[0,1,2])e.push({min:gt(`.min-db[data-preset="${t}"]`).value,max:gt(`.max-db[data-preset="${t}"]`).value,boost:gt(`.linear-boost[data-preset="${t}"]`).value});os(Re,e)}if(!e||e==$e){const e={info:jt.value,track:Pa.value,end:Rt.value,covers:wa.checked,count:ka.checked};os($e,e)}if(!e||e==Te){const e={autoHide:xt.checked,bgLocation:At.value,bgMaxItems:Tt.value,fftSize:_t.value,fsHeight:Bt.value,maxFPS:Xt.value,pipRatio:ia.value,saveDir:ma.checked,saveQueue:ba.checked,smoothing:Sa.value};os(Te,e)}}function os(e,t){const a=JSON.stringify(t);F?electron.api("storage-set",e,a):localStorage.setItem(e,a)}function ss(e,t,a,n){const o=`User Preset #${e+1}`,s=rn[e].name||"",i=Ga.isFullscreen;if(!Xn(rn[e])&&!n&&Tn!==e)return void(i?(cs(`Overwrite ${o} - Press again to confirm!`,5),Tn=e,setTimeout((()=>{Tn===e&&(Tn=!1)}),5e3)):D().confirm({text:`Do you really want to overwrite ${o}?<br>${s}`,submitText:"Overwrite",submitCallback:()=>{ss(e,t,a,!0)},cancelCallback:()=>{D().alert({text:"Canceled!"})}}));if(Tn=!1,!a||!`${a}`.trim()){if(!i)return void D().input({text:"Give this preset a name or short description",submitText:"Save",value:s,maxlength:40,submitCallback:a=>{ss(e,t,a.trim()||He,!0)},cancelCallback:()=>{D().alert({text:"Save canceled!"})}});a=""}a==He&&(a=""),rn[e]={name:a,options:t},os(xe,rn);const l=`Saved to ${o}`;i?cs(l,5):D().alert({text:l})}function is(e,t=1){Xa=setTimeout((()=>{An=e,$o(t)}),200)}function ls(e){document.documentElement.style.setProperty("--background-image",e?`url( ${e.replace(/['()]/g,"\\$&")} )`:"none")}function rs(e){St.dataset.value=e,en&&(en.pan.value=Math.log10(9*Math.abs(e)+1)*Math.sign(e)),St.querySelector(".marker").style.transform=`rotate( ${145*e-90}deg )`}function cs(e,t=2,a=-1){if(e){const n=performance.now(),o=n+1e3*t;e==+e?(Ya.info=e,Ya.startTime=n,Ya.endTime=Math.max(o,Ya.endTime||0),Ya.fade=t==1/0?0:t/3*a):(Ya.msg=e,2==Ya.info&&(Ya.info=1),Ya.msgTimer=o)}else Ya={endTime:0,msgTimer:0}}function ds(){Mn.src=Ln[Ja].dataset.cover,Lt.value==J&&ls(Mn.src)}function us(e){xt.checked=e.autoHide,At.value=e.bgLocation,Tt.value=e.bgMaxItems,_t.value=e.fftSize,Bt.value=e.fsHeight,Xt.value=e.maxFPS,sa.value=e.osdFontSize,ia.value=e.pipRatio,ma.checked=e.saveDir,ba.checked=e.saveQueue,Sa.value=e.smoothing}function fs(e){jt.value=e.info,Pa.value=e.track,Rt.value=e.end,wa.checked=e.covers,ka.checked=e.count}function ps(e=""){F&&(e=ro(e),Gt.dataset.path=Dn(e),Gt.innerText=no(e).fileName,Gt.title=_n(e,!0))}function hs(){const e=Lt.value[0],t=eo(),a=t||e!=G&&e!=Y;for(const e of Ln)e.style.display=t&&e==Ln[Ja]?"":"none";return Ga.overlay=a,Ga.showBgColor=!t&&e==G,It.style.backgroundImage=t?"none":"var(--background-image)",Oa.style.display=t||e!=V?"none":"",a}function ms(e,t=!0){Array.isArray(e)||(e=[e]);const a=()=>Nt.style.display=Hn(Pt)==de||Qn(Kt)?"none":"";for(const n of e){switch(n){case yt:Ga.alphaBars=Qn(yt);break;case wt:Ga.ansiBands=Qn(wt);break;case xt:Es(!0);break;case Lt:const e=Lt.value[0],o=Lt[Lt.selectedIndex].idx,s=hs();if(e==V){ls();const e=En[void 0===o?lo(En.length):o].url;Oa.src.endsWith(e)||(Oa.src=e)}else s?ls(e==J?Mn.src:Sn[void 0===o?lo(Sn.length):o].url):ls();break;case Et:Ga.barSpace=Ga.isLumiBars?1.5:Hn(Et);break;case $t:const i=$t.value,l=i==se||i==ie||i==le;It.classList.toggle("repeat",i==ne),It.classList.toggle("cover",i==te||l),It.style.backgroundSize="",Ma.style.display=l?"":"none",Ma.classList.toggle("rotating",i==le),Ma.classList.toggle("paused",i==se);break;case Ct:Mt.style.background=`rgba(0,0,0,${1-Ct.value})`;break;case At:At.value==ee?window.showDirectoryPicker({startIn:"pictures"}).then((e=>{(0,M.hZ)(ke,e)})).catch((e=>{At.value=Z,(0,M.yH)(ke)})).finally((()=>Zo())):((0,M.yH)(ke),Zo());break;case Tt:Uo();break;case Pt:Ga.channelLayout=Hn(Pt),a();break;case Ot:Ga.colorMode=Hn(Ot);break;case Dt:Ga.fillAlpha=Qt.value==De?1:Dt.value;break;case _t:Ga.fftSize=_t.value,xo("FFT size is "+Ga.fftSize+" samples");break;case Ft:Ga.showFPS=Qn(Ft);break;case qt:Ga.frequencyScale=Hn(qt);break;case Bt:kt.style.height=`${Bt.value}%`;break;case Ht:case Nt:""===n.value&&(n.selectedIndex=0),Qn(Kt)?Ga.gradient=Ht.value=Nt.value=n.value:Ga[n==Ht?"gradientLeft":"gradientRight"]=n.value;break;case zt:Ga.ledBars=Qn(zt);break;case Ut:Ga.linearAmplitude=Qn(Ut);break;case Wt:Ga.lineWidth=Qt.value==De?0:Wt.value;break;case Kt:a(),Qn(Kt)&&ms(Ht,!1);break;case Yt:Ga.loRes=Qn(Yt);break;case Jt:Ga.lumiBars=Qn(Jt),ms(Et,!1);break;case Xt:Ga.maxFPS=Xt.value;break;case Zt:Ga.mirror=Hn(Zt);break;case Qt:const r=Qt.value;[De,Fe].includes(r)?Ga.mode=10:Ga.mode=r,r==De?(Ga.lineWidth=0,Ga.fillAlpha=1):(Ga.lineWidth=Wt.value,Ga.fillAlpha=Dt.value),ms(Et,!1);break;case ea:As();break;case aa:Ga.noteLabels=Qn(aa);break;case sa:wo();break;case na:Ga.outlineBars=Qn(na);break;case ia:Vn()&&(Ga.width=Ga.height*ia.value);break;case ra:Ga.radial=Qn(ra),ms(Et,!1);break;case ca:const c=ca.value;nn&&(nn=clearInterval(nn)),c>1&&(nn=setInterval(Jo,2500*c));break;case ua:case da:for(;+da.value<=+ua.value;)da.selectedIndex++;Ga.setFreqRange(ua.value,da.value);break;case fa:switch(Hn(fa)){case Ne:Ga.reflexRatio=.4,Ga.reflexAlpha=.2;break;case je:Ga.reflexRatio=.5,Ga.reflexAlpha=1;break;default:Ga.reflexRatio=0}break;case ha:Ga.roundBars=Qn(ha);break;case ma:ma.checked?co(g):((0,M.yH)(Oe),Xo(Oe));break;case ba:ba.checked?xs(!0):(0,M.yH)(Me);break;case ga:Ga.showScaleX=Qn(ga);break;case va:Ga.showScaleY=Qn(va);break;case ya:const d=Hn(ya);Ga.setSensitivity(gt(`.min-db[data-preset="${d}"]`).value,gt(`.max-db[data-preset="${d}"]`).value),Ga.linearBoost=gt(`.linear-boost[data-preset="${d}"]`).value;break;case xa:Ga.showPeaks=Qn(xa);break;case Sa:Ga.smoothing=Sa.value,xo("smoothingTimeConstant is "+Ga.smoothing);break;case Ea:const u=Ea.checked;t=!1,bs(u,(e=>{u&&e?(cn=ea.checked,As(!0)):u||As(!!cn),Ps()}));break;case Ca:Ga.spinSpeed=Ca.value;break;case $a:Ga.splitGradient=Qn($a);break;case Ra:Ga.weightingFilter=Hn(Ra)}t&&(za.includes(n)?ns(Te):Ps())}}async function bs(e,t){Ea.checked=e,e?F&&!await electron.api("ask-for-media-access")||!navigator.mediaDevices?(xo("Cannot access user microphone",!0),Ea.checked=!1,t&&t(!1)):navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{Za=Ga.audioCtx.createMediaStreamSource(e),Zn()&&Ln[Ja].pause(),Ga.connectInput(Za),xo("Audio source set to microphone")})).catch((e=>{xo(`Could not change audio source - ${e}`,!0),Ea.checked=!1})).finally((()=>{t&&t(Ea.checked)})):(Za&&(Ga.disconnectInput(Za),Za.mediaStream.getTracks()[0].stop(),Za=null),xo("Audio source set to built-in player"),t&&t(!0))}function gs(e){Ia.dataset.value=e,Ga.volume=e**2.5,Ia.querySelector(".marker").style.transform=`rotate( ${125+290*e}deg )`}function vs(){let e;It.addEventListener("mouseenter",(()=>{xt.checked&&Es(!1)})),gt(".player-area").addEventListener("mouseleave",(()=>Es(!0))),It.addEventListener("transitionend",(()=>{It.style.height&&(Vt.style.display="none"),document.body.style.overflowY=""})),Ta.addEventListener("click",(()=>{Es(!0),Ts()})),gt(".settings-close").addEventListener("click",(()=>Ts())),Aa.addEventListener("click",(()=>{Es(!0),Ss(),Aa.classList.remove("warning"),xo()})),gt("#console-close").addEventListener("click",(()=>Ss())),gt("#console-clear").addEventListener("click",(()=>xo("Console cleared.",!1,!0))),vt(".switch").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.active=+!+e.dataset.active,ms(e)}))})),vt("[data-prop]").forEach((e=>{Yn(e)?e.elements[e.dataset.prop].forEach((t=>{t.addEventListener("click",(()=>ms(e)))})):e.addEventListener("change",(()=>{ms(e),Os(e)}))})),[Ia,St].forEach((t=>{t.addEventListener("wheel",(a=>{if(a.preventDefault(),e)return;e=setTimeout((()=>e=!1),50);const n=Math.sign(a.deltaY||0);t==Ia?yo(n):go(n)}))})),St.addEventListener("dblclick",(()=>{go(0)})),gt("#btn_play").addEventListener("click",(()=>No())),gt("#btn_stop").addEventListener("click",ws),gt("#btn_shuf").addEventListener("click",ys),gt("#btn_prev").addEventListener("mousedown",(()=>is("m",-1))),gt("#btn_prev").addEventListener("click",(e=>{Ao()||ks(!0)})),gt("#btn_next").addEventListener("mousedown",(()=>is("m"))),gt("#btn_next").addEventListener("click",(()=>{Ao()||ks()})),gt("#load_preset").addEventListener("click",(()=>{const e=[];_a.forEach((t=>{Xn(t.options)||e.push({text:t.name+("default"==t.key?" (warning: resets Volume!)":""),handler:()=>Do(t.key)})})),e.push({text:"<strong>USER PRESETS →</strong>",handler:()=>{const e=[];Kn().forEach(((t,a)=>{e.push({text:t,handler:()=>Do(a)})})),D().select({text:"LOAD PRESET:",choices:e})}}),D().select({text:"LOAD PRESET:",choices:e})})),gt("#btn_save").addEventListener("click",(()=>{const e=[];Kn().forEach(((t,a)=>{const n=rn[a].options;e.push({type:1,text:t,handler:()=>ss(a,Nn())},{type:2,text:Xn(n)?"":'<button title="Edit name">&#xf11f;</button>',handler:()=>ss(a,n,"",!0)},{type:2,text:Xn(n)?"":'<button title="Delete preset">&#xf120;</button>',handler:()=>Co(a)})})),D().select({text:"<strong>Click slot to SAVE - Use buttons to Edit or Delete</strong>",choices:e})})),gt("#btn_fullscreen").addEventListener("click",To),gt("#save_playlist").addEventListener("click",(()=>{if(F){const e=Gt.dataset.path;e?D().confirm({text:`<strong>${Gt.innerText}</strong><br>will be overwritten with the current play queue<br>ARE YOU SURE?`,submitText:"Overwrite",submitCallback:()=>as(e,!0),cancelCallback:()=>D().alert({text:"Canceled"})}):as()}else e=la.selectedIndex,""==la[e].value?xs():la[e].dataset.isLocal?D().confirm({text:`Overwrite "${la[e].innerText}" with the current play queue?`,submitText:"Overwrite",submitCallback:()=>{xs(la[e].value)},cancelCallback:()=>{D().alert({text:"Canceled"})}}):D().alert({text:'This is a server playlist which cannot be overwritten.<br>Click "Save as..." to create a new local playlist.',time:5});var e})),gt("#create_playlist").addEventListener("click",(()=>F?as():xs())),gt("#btn_clear").addEventListener("click",(()=>{!function(){for(;tn.hasChildNodes();)es(tn.removeChild(tn.firstChild));Zn()?an=-1:(an=0,ko(Ja)),ko(Qa),$s()}(),ps(),xs(!0)})),(F?gt(".playlist-bar"):Gt).style.display="none",F||(gt("#load_playlist").addEventListener("click",(()=>{_o({file:la.value}).then((e=>{const t=-1==e?"No playlist selected":`${e} song${e>1?"s":""} added to the queue`;D().alert({text:t,time:5})}))})),gt("#delete_playlist").addEventListener("click",(()=>{return e=la.selectedIndex,void(la[e].dataset.isLocal?D().confirm({text:`Do you really want to DELETE the "${la[e].innerText}" playlist?<br>THIS CANNOT BE UNDONE!`,submitText:"Delete",submitCallback:async()=>{const t=la[e].value,a=_e+t,n=await(0,M.Jt)(Ie);n&&delete n[t],await(0,M.yH)(a),await(0,M.hZ)(Ie,n),D().alert({text:"Playlist deleted"}),Fo()},cancelCallback:()=>{D().alert({text:"Canceled"})}}):la[e].value&&D().alert({text:"Cannot delete a server playlist!"}));var e}))),oa.addEventListener("click",(()=>Cs()));const t=gt("#btn_toggle_filesystem"),a=()=>t.innerText="Switch to "+(ln?"Server":"Device");(Va||ln)&&sn?(a(),t.addEventListener("click",(async()=>{ln=!ln;const e=await(ln?(0,M.Jt)(Oe):Mo(Oe));var t;ln&&e&&"granted"!=await e[0].handle.requestPermission()?ln=!1:(x=!x,g=[],u=null,y=[x?r:o],(t=e)?O(t):L(),a(),os(Ae,ln))}))):t.style.display="none";const n=gt("#btn_add_selected"),s=gt("#btn_add_folder");F||Va||ln?(n.addEventListener("mousedown",(()=>po($(".selected")))),s.addEventListener("click",(()=>po($())))):(n.style.display="none",s.style.display="none");const i=gt("#local_file");let l,c;F||sn?i.parentElement.style.display="none":i.addEventListener("change",(e=>function(e){const t=e.files[0];if(t){ko();const e=Ln[Ja];e.dataset.file=t.name,e.dataset.title=no(t.name).baseName,Io(t,e,!0).then((e=>I.WC(e))).then((t=>ho(t,e))).catch((e=>{}))}}(e.target))),gt("#btn_load_url").addEventListener("click",(()=>{D().input({text:"Load audio file or stream from URL",submitText:"Load",submitCallback:e=>{e.trim()&&(bo({file:e},!0),xs(!0))}})}));const d=gt("#btn_pip");document.pictureInPictureEnabled?d.addEventListener("click",(async()=>{if(Rn!==document.pictureInPictureElement){const e=Ga.canvas.captureStream();l=e.getTracks()[0],Rn.muted=!0,Rn.srcObject=e,await Rn.play(),Rn.requestPictureInPicture()}else document.exitPictureInPicture()})):d.classList.add("disabled");const f=((e,t=300)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}})((()=>Ga.setCanvasSize(c.width,c.height)));Rn.addEventListener("enterpictureinpicture",(e=>{c=e.pictureInPictureWindow,It.classList.add("pip"),d.classList.add("active"),Ga.setCanvasSize(c.height*ia.value,c.height),c.addEventListener("resize",f)})),Rn.addEventListener("leavepictureinpicture",(()=>{c.removeEventListener("resize",f),Rn.pause(),l.stop(),Rn.srcObject=l=null,d.classList.remove("active"),It.classList.remove("pip"),Ga.setCanvasSize()}));const p=navigator.mediaSession;p&&(p.setActionHandler("play",(()=>No())),p.setActionHandler("pause",(()=>No())),p.setActionHandler("previoustrack",(()=>jo())),p.setActionHandler("nexttrack",(()=>Ho()))),gt("#add-gradient").addEventListener("click",Bo),gt("#btn-save-gradient").addEventListener("click",ts),gt("#btn-delete-gradient").addEventListener("click",Eo),gt("#new-gradient-bkgd").addEventListener("input",(e=>{Cn.bgColor=e.target.value})),gt("#new-gradient-name").addEventListener("input",(e=>{Cn.name=e.target.value})),gt("#new-gradient-horizontal").addEventListener("input",(e=>{Cn.dir=e.target.checked?"h":void 0}))}function ys(){for(let e=io()-1;e>0;e--){const t=Math.random()*(e+1)|0,a=tn.replaceChild(tn.children[t],tn.children[e]);tn.insertBefore(a,tn.children[t])}zo(0),xs(!0)}function ks(e=!1){(e?jo():Ho())||cs(`Already at ${e?"first":"last"} track`)}function ws(){Ln[Ja].pause(),cs(),qo(0)}async function xs(e,t=!0){const a=1==e;if(!a||ba.checked)if(0!=io()||a)if(e){let n=e;if(!a&&!t){n=n.normalize("NFD").replace(/[\u0300-\u036f]/g,""),n=n.toLowerCase().replace(/[^a-z0-9]/g,"_");let t=await(0,M.Jt)(Ie)||{},a=0,o=n;for(;t.hasOwnProperty(n)&&a<100;)n=o+"_"+a,a++;t[n]=e,await(0,M.hZ)(Ie,t),Fo(n)}let o=[];for(const e of tn.childNodes)o.push({file:e.dataset.file,handle:e.handle});a?(0,M.hZ)(Me,o):(0,M.hZ)(_e+n,o).then((()=>D().alert({text:"Playlist saved!"})))}else D().input({text:"Give this playlist a name:",submitText:"Save",submitCallback:e=>{e&&xs(e,!1)},cancelCallback:()=>{D().alert({text:"Canceled"})}});else D().alert({text:"Queue is empty!"})}function Ls(e){for(const t of Ln)t.dataset.file==e.dataset.file&&ho(e,t)}function Ss(e){gt("#console").classList.toggle("active",Aa.classList.toggle("active",e))}function Es(e){document.body.style.overflowY="hidden",e?Vt.style.display="":(Ss(!1),Ts(!1)),It.style.height=e?"":"calc( 100vh - 160px )"}function Cs(){Ya.endTime<performance.now()&&(Ya.info=0),2==Ya.info?cs():cs(1+(0|Ya.info),+jt.value||1/0)}function $s(){const e=tn.querySelector(".current"),t=tn.children[an];e&&e.classList.remove("current"),t&&(t.classList.add("current"),t.scrollIntoViewIfNeeded())}function As(e){void 0!==e?ea.checked=e:e=ea.checked,e?Ga.disconnectOutput():Ga.connectOutput()}function Ts(e){gt("#settings").classList.toggle("active",Ta.classList.toggle("active",e))}function Ps(){os(Pe,{...Nn(),balance:St.dataset.value,micSource:Ea.checked,mute:ea.checked,volume:Ia.dataset.value})}function Os(e){const t=e.previousElementSibling;t&&"value"==t.className&&(t.innerText=e.value)}!async function(){const e=e=>{Ho(!0)||(qo(0),cs("Queue ended",10),Vn()&&Rn.pause())},t=e=>{e.target.attributes.src&&xo("Error loading "+e.target.src,!0)},a=e=>{Ln[Ja].attributes.src?(Vn()&&Rn.play(),Ln[Ja].currentTime<.1&&"1"==ca.value&&Jo(!0),Qn(La)&&cs(1,+Pa.value||1/0)):zo(an)};window.addEventListener("error",(e=>xo(`Unexpected ${e.error}`,!0)));let c,E=!1;xo(`audioMotion v${z} initializing...`),xo(`User agent: ${navigator.userAgent}`),gt("#version").innerText=z;try{c=await fetch(ht)}catch(e){}let $=c&&200==c.status?await c.text():null;try{$=JSON.parse($)}catch(e){xo(`Error parsing ${ht} - ${e}`,!0),$={}}$={...mt,...$},sn=$.enableLocalAccess&&!!window.showDirectoryPicker;const A=new URL(document.location).searchParams,T=A.get("mode"),P=A.get("mediaPanel");let I=$.enableLocalAccess&&(T==ye||"server"!=T&&await Mo(Ae));null===I&&(I=$.defaultAccessMode==ye),(P==qe||$.mediaPanel==qe&&P!=Be)&&Es(!1),F&&xo(`Reading user preferences from ${await electron.api("storage-info")}`);const _=await async function(){const e=(e,t)=>{Array.isArray(e)&&e.forEach((e=>{const{value:a,disabled:n}="object"==typeof e?e:{value:e,disabled:!0},o=Array.isArray(t)?t.find((e=>e.value==a)):t[a];o&&(o.disabled=n)}))},t=await Mo(Pe),a=null!==t;((e,t)=>{const a=jn("last");-1!=a&&(_a[a].options=t)})(0,{...zn("default"),...t}),rn=await Mo(xe)||[],Array.isArray(rn)||(rn=[{name:"Custom",options:rn}]);for(let e=0;e<9;e++)void 0===rn[e]?rn[e]={}:Xn(rn[e])||rn[e].options||(rn[e]={options:rn[e]});e(await Mo(Ee),Fa),e(await Mo(Le),ja);const n=await Mo(we);n&&Object.keys(n).forEach((e=>{Da[e]=n[e]})),e(await Mo(Se),Da),e(await Mo(Ce),Ba);const o=vt(".min-db");o.forEach((e=>fo(e,-120,-60)));const s=vt(".max-db");s.forEach((e=>fo(e,-50,0)));const i=vt(".linear-boost");i.forEach((e=>fo(e,1,5,.2))),(await Mo(Re)||Ha).forEach(((e,t)=>{o[t].value=e.min,s[t].value=e.max,i[t].value=e.boost||Ha[t].boost})),fs({...Na,...await Mo($e)||{}});for(let e=10;e<16;e++)_t[_t.options.length]=new Option(2**e);return fo(Sa,0,.9,.1),Yo(ia,Ka),fo(Bt,25,100,5),Yo(Xt,Wa),Yo(At,[[Z,"Disable"],[Q,"Server"],[...sn?[ee,"Local device"]:[]]]),fo(Tt,0,100),Yo(sa,[["0","Small"],["1","Medium"],["2","Large"]]),us({...Ua,...await Mo(Te)||{}}),a}();tn=gt("#playlist"),tn.addEventListener("dblclick",(e=>{e.target&&e.target.dataset.file&&(zo(qn(e.target)),e.target.classList.remove("selected","sortable-chosen"))})),an=0,R.Ay.create(tn,{animation:150,group:{name:"filelist",pull:!1,put:!0},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",onEnd:e=>{an=qn(tn.querySelector(".current")),0!=e.newIndex||Zn()||qo(0),Ro(),xs(!0)}}),xo(`Instantiating audioMotion-analyzer v${n.A.version}`),Ga=new n.A(kt,{fsElement:It,onCanvasDraw:(e,t)=>{if(!Ln.length)return;const a=Ln[Ja],n=a.dataset,o=a.duration-a.currentTime,s=+Rt.value,i=Lt.value[0],l=$t.value,r=Qn(ta),c=e.pixelRatio,{timestamp:d}=t;if(o<.1&&Ho(!0),s>0&&o<=s&&Qn(La)&&d>Ya.endTime&&Zn()&&cs(1,o,1),!(l!=oe&&"4"!=l&&"5"!=l||i!=J&&i!=X)){let t;if(l==oe)t=(70*e.getEnergy()|0)-25;else{const e=a.currentTime/a.duration;t=100*("4"==l?e:1-e)}It.style.backgroundSize=`auto ${100+t}%`}oa.width|=0;const{endTime:u,startTime:f,msgTimer:p,info:h,msg:m,fade:b}=Ya;if(d>u&&d>p)return;const g=(e,t,a,n)=>{r?(In.strokeText(e,t,a,n),In.fillText(e,t,a,n)):(In.shadowOffsetX=In.shadowOffsetY=3*c,In.fillText(e,t,a,n),In.shadowOffsetX=In.shadowOffsetY=0)};if(In.lineWidth=4*c,In.lineJoin="round",In.font=wn,In.textAlign="center",In.fillStyle="#fff",In.strokeStyle=In.shadowColor="#000",p>d&&(d>u||2!=h)){const e=(p-d)/1e3;In.globalAlpha=e>1?1:e,g(Ya.msg,fn,hn)}if(u>d){if(b<0){const e=(u-d)/1e3;In.globalAlpha=e>-b?1:e/-b}else{const e=Math.max(0,(d-f)/1e3);In.globalAlpha=e>b?1:e/b}if(2==Ya.info&&(g(Wn(),fn,hn,yn),In.textAlign="left",g(Bn(Qt),dn,hn,yn),g(`Randomize: ${Bn(ca)}`,dn,mn,yn),In.textAlign="right",g(Bn(ya).toUpperCase()+" sensitivity",pn,hn,yn),g(`Repeat is ${ao(pa)}`,pn,mn,yn)),Ea.checked)In.textAlign="left",In.font=xn,g("MIC source",dn,gn,kn);else{In.textAlign="right",g(n.codec,pn,bn),g(n.quality,pn,bn+dn);const e=io();e&&ka.checked&&g(`Track ${an+1} of ${e}`,pn,bn-dn),In.textAlign="left",g(n.artist.toUpperCase(),dn,bn,kn),In.font=`italic ${wn}`,g(n.album,dn,vn,kn),In.font=xn,g(a.src?n.title:"No song loaded",dn,gn,kn),(a.duration||n.duration)&&(n.duration||(n.duration=uo(a.duration),tn.children[an]&&(tn.children[an].dataset.duration=n.duration)),In.textAlign="right",g(uo(a.currentTime)+" / "+n.duration,pn,vn)),Mn.width&&wa.checked&&In.drawImage(Mn,dn,bn-1.3*un,un,un)}}},onCanvasResize:(e,t)=>{let a;switch(wo(t),e){case"create":xo(`Display resolution: ${t.fsWidth} x ${t.fsHeight} px (pixelRatio: ${window.devicePixelRatio})`),a="Canvas created";break;case"lores":a=`Lo-res ${t.loRes?"ON":"OFF"} (pixelRatio = ${t.dPR})`;break;case"fschange":a=(t.isFullscreen?"Enter":"Exit")+"ed fullscreen";break;case"user":a=(Vn()?"Resized for":"Closed")+" PIP";break;default:return}xo(`${a||e}. Canvas size is ${t.canvas.width} x ${t.canvas.height} px`)}});const q=Ga.audioCtx;q.createStereoPanner&&(en=q.createStereoPanner(),Ga.connectInput(en)),Ja=0,Qa=1;for(const n of[0,1])Ln[n]=gt(`#player${n}`),ko(n),Ln[n].addEventListener("play",a),Ln[n].addEventListener("ended",e),Ln[n].addEventListener("error",t),en?q.createMediaElementSource(Ln[n]).connect(en):Ga.connectInput(Ln[n]);!function(){const e=(e,t,a,n,o)=>{a.forEach((a=>{e.innerHTML+=`<label><input type="checkbox" class="${t}" data-option="${a.value}" ${a.disabled?"":"checked"}> ${a.text}</label>`})),vt(`.${t}`).forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&a.filter((e=>!e.disabled)).length<2)return D().alert({text:"At least one item must be enabled!"}),t.preventDefault(),!1;const s=a.find((t=>t.value==e.dataset.option));s&&(s.disabled=!e.checked,Yo(n,a),ns(o))}))}))};e(gt("#enabled_modes"),"enabledMode",Fa,Qt,Ee),e(gt("#enabled_bgfit"),"enabledBgFit",ja,$t,Le);const t=gt("#enabled_gradients");Object.keys(Da).forEach((e=>{t.innerHTML+=`<label><input type="checkbox" class="enabledGradient" data-grad="${e}" ${Da[e].disabled?"":"checked"}> ${Da[e].name}</label>`})),Ko();const a=gt("#random_properties");Ba.forEach((e=>{a.innerHTML+=`<label><input type="checkbox" class="randomProperty" value="${e.value}" ${e.disabled?"":"checked"}> ${e.text}</label>`})),vt(".randomProperty").forEach((e=>{e.addEventListener("click",(t=>{Ba.find((t=>t.value==e.value)).disabled=!e.checked,ns(Ce)}))})),vt("[data-preset]").forEach((e=>{"reset-sens"==e.className?e.addEventListener("click",(()=>{const t=e.dataset.preset;gt(`.min-db[data-preset="${t}"]`).value=Ha[t].min,gt(`.max-db[data-preset="${t}"]`).value=Ha[t].max,gt(`.linear-boost[data-preset="${t}"]`).value=Ha[t].boost,vt(`[data-preset="${t}"]`).forEach((e=>{e.classList.remove("field-error")})),e.dataset.preset==Hn(ya)&&ms(ya,!1),ns(Re)})):e.addEventListener("change",(()=>{const t=+e.value>=+e.min&&+e.value<=+e.max;t&&(e.dataset.preset==Hn(ya)&&ms(ya,!1),ns(Re)),e.classList.toggle("field-error",!t)}))}));for(const e of[jt,Pa,Rt,wa,ka])e.addEventListener("change",(()=>ns($e)));gt("#reset_osd").addEventListener("click",(()=>{fs(Na),ns($e)})),za.forEach((e=>{e.addEventListener("change",(()=>ms(e)))})),gt("#reset_general").addEventListener("click",(()=>{us(Ua),ms(za)}))}(),Yo(Qt,Fa);for(const e of[16,20,25,30,40,50,60,100,250,500,1e3,2e3])ua[ua.options.length]=new Option((e>=1e3?e/1e3+"k":e)+"Hz",e);for(const e of[1e3,2e3,4e3,8e3,12e3,16e3,2e4,22e3])da[da.options.length]=new Option(e/1e3+"kHz",e);Wo(Pt,qa),Wo(ya,[["0","Low"],["1","Normal"],["2","High"]]),Wo(Et,[["1.5","Min"],["0.1","10"],["0.25","25"],["0.5","50"],["0.75","75"]]),Yo(ca,[["0","OFF"],["1","On track change"],["2","5 seconds"],["6","15 seconds"],["12","30 seconds"],["24","1 minute"],["48","2 minutes"],["120","5 minutes"]]),Wo(fa,[["0","Off"],["1","On"],["2","Full"]]),Yo($t,ja),Wo(Zt,[["-1","Left"],["0","Off"],["1","Right"]]),Wo(qt,[[dt,"Bark"],["linear","Lin"],[ut,"Log"],["mel","Mel"]]),Wo(Ra,[["","OFF"],["A","A"],["B","B"],["C","C"],[bt,"D"],["468","468"]]),Wo(Ot,[[ue,"Gradient"],[fe,"Index"],[pe,"Level"]]),fo(Ct,.1,1,.1),fo(Wt,1,3,.5),fo(Dt,0,.5,.1),fo(Ca,0,3,1),cs(),Object.keys(Da).forEach((e=>{const{bgColor:t,dir:a,colorStops:n}=Da[e];n&&Ga.registerGradient(e,{bgColor:t,dir:a,colorStops:n})})),Go();const B=function(e,t={}){let a;var n;return h=document.createElement("ul"),h.className="breadcrumb",e.append(h),m=document.createElement("ul"),m.className="filelist",e.append(m),a=setTimeout((()=>{h.innerHTML="Waiting for server..."}),5e3),h.innerHTML="Initializing... please wait...",h.addEventListener("click",(async function(e){e.target&&"LI"==e.target.nodeName&&function(e){let t;for(;e>0;)t=g.pop(),e--;const a=g[g.length-1];a&&a.handle&&(u=a.handle,t=null),S(t,t&&t.scrollTop)}(e.target.dataset.depth)})),m.addEventListener("click",(async function(e){const t=e.target;if(t&&"LI"==t.nodeName)if("dir"==t.dataset.type)S(t.handle||t.dataset.path);else if("mount"==t.dataset.type)if(x)try{u=await window.showDirectoryPicker({startIn:"music"}),g=[],S(u)}catch(e){}else g=[],S(t.dataset.path)})),m.addEventListener("dblclick",(function(e){const t=e.target;t&&"LI"==t.nodeName&&f&&["file","list"].includes(t.dataset.type)&&f({file:C(t.dataset.path),handle:t.handle},e)})),"function"==typeof t.onDblClick&&(f=t.onDblClick),"function"==typeof t.onEnterDir&&(p=t.onEnterDir),t.fileExtensions&&(n=t.fileExtensions,v=new RegExp("\\.("+n.join("|")+")$","i")),new Promise((e=>{fetch("/serverInfo").then((e=>e.text())).then((async n=>{if(clearTimeout(a),n.startsWith("audioMotion")?(k=!0,b=1):b=d,1==b&&s){const e=await fetch("/getMounts");y=await e.json(),O(await async function(){const e=await fetch("/getHomeDir"),t=await e.text();let a=[];for(const e of t.split(i?"\\":"/"))a.push({dir:e,scrollTop:0});return a}())}else y=[t.rootPath||o],w=await S(y[0]),(t.forceFileSystemAPI&&l||!w)&&(g=[],l?(y=[r],x=!0):y=[],L());e({serverMode:b,useFileSystemAPI:x,hasServerMedia:w,filelist:m,serverSignature:b==d?"Standard web server":n})})).catch((t=>{clearTimeout(a),b=-1,l?(y=[r],x=!0):y=[],L(),e({serverMode:b,useFileSystemAPI:x,filelist:m})}))}))}(gt("#file_explorer"),{onDblClick:(e,t)=>{po([e],!0),t.target.classList.remove("selected","sortable-chosen")},onEnterDir:e=>{ma.checked&&E&&co(e)},fileExtensions:[...me,...ge,...ve],forceFileSystemAPI:I}).then((e=>{on=e.serverMode,Va=e.hasServerMedia,ln=e.useFileSystemAPI;const{filelist:t,serverSignature:a}=e;on!=pt&&xo(`${a} detected at ${j}`),Va||xo(on==pt?"No server found":"Cannot access music directory on server",!0),ln&&xo("Accessing files from local device via File System Access API."),!sn&&$.enableLocalAccess&&xo("No browser support for File System Access API. Cannot access files from local device.",I),F||(os(Ae,I&&sn),Fo()),(F||ln||Va)&&R.Ay.create(t,{animation:150,draggable:'[data-type="file"], [data-type="list"]',group:{name:"filelist",pull:"clone",put:!1},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",sort:!1,onEnd:e=>{if("playlist"==e.to.id){let t=e.items.length?e.items:[e.item],a=[];t.forEach((e=>{a.push(bo({file:C(e.dataset.path),handle:e.handle})),e.remove()})),Promise.all(a).then((()=>xs(!0)))}}}),vs()}));window.addEventListener("keydown",Po),window.addEventListener("keyup",Po),D().setOptions({positions:{alert:"bottom"}}),Promise.all([Zo(),B]).then((async()=>{const e=()=>{a&&O(a),ba.checked&&_o({file:!0})},t=async()=>{!(o&&"granted"!=await n.requestPermission()||s&&"granted"!=await a[0].handle.requestPermission())&&(Vt.classList.remove("locked"),window.removeEventListener("click",t),o&&Zo(),e())},a=await(ln?(0,M.Jt)(Oe):Mo(Oe)),n=await(0,M.Jt)(ke),o=sn&&n&&"granted"!=await n.queryPermission(),s=ln&&Array.isArray(a)&&a[0]&&"granted"!=await a[0].handle.queryPermission();xo(`Loading ${_?"last session":"default"} settings`),Do("last",!1,!0),o||s?(Vt.classList.add("locked"),window.addEventListener("click",t)):e(),xo(`AudioContext sample rate is ${q.sampleRate}Hz; Total latency is ${1e3*((q.outputLatency||0)+q.baseLatency)|0}ms`),xo("Initialization complete!"),E=!0}))}()},6216:()=>{Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,a=window.getComputedStyle(t,null),n=parseInt(a.getPropertyValue("border-top-width")),o=parseInt(a.getPropertyValue("border-left-width")),s=this.offsetTop-t.offsetTop<t.scrollTop,i=this.offsetTop-t.offsetTop+this.clientHeight-n>t.scrollTop+t.clientHeight,l=this.offsetLeft-t.offsetLeft<t.scrollLeft,r=this.offsetLeft-t.offsetLeft+this.clientWidth-o>t.scrollLeft+t.clientWidth,c=s&&!i;(s||i)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-n+this.clientHeight/2),(l||r)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-o+this.clientWidth/2),(s||i||l||r)&&!e&&this.scrollIntoView(c)})},143:()=>{},3411:()=>{}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e].call(s.exports,s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,a,o,s)=>{if(!a){var i=1/0;for(d=0;d<e.length;d++){for(var[a,o,s]=e[d],l=!0,r=0;r<a.length;r++)(!1&s||i>=s)&&Object.keys(n.O).every((e=>n.O[e](a[r])))?a.splice(r--,1):(l=!1,s<i&&(i=s));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,o,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[i,l,r]=a,c=0;if(i.some((t=>0!==e[t]))){for(o in l)n.o(l,o)&&(n.m[o]=l[o]);if(r)var d=r(n)}for(t&&t(a);c<i.length;c++)s=i[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},a=self.webpackChunkaudioMotion=self.webpackChunkaudioMotion||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[96],(()=>n(6965)));o=n.O(o)})();